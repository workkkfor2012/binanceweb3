è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯å®ç°æ–¹æ¡ˆï¼Œæ¶µç›–äº†ä»é‡‡é›†ã€ä¼ è¾“ã€åç«¯å¤„ç†åˆ°å‰ç«¯å±•ç¤ºçš„æ•´ä¸ªé“¾è·¯ã€‚è¿™é‡ŒåŒ…å«äº† 5 ä¸ªå…³é”®æ–‡ä»¶çš„ä¿®æ”¹ï¼šShared Types: å®šä¹‰é€šç”¨çš„æ•°æ®æ¥å£ã€‚Backend Types: Rust ç»“æ„ä½“é€‚é…ã€‚Backend Logic: Socket è½¬å‘ä¸è¿‡æ»¤é€»è¾‘ã€‚Extractor: æ•°æ®é‡‡é›†ä¸æ˜ å°„ã€‚Frontend: ç•Œé¢å±•ç¤ºä¸ Tab åˆ‡æ¢ã€‚1. ä¿®æ”¹å…±äº«ç±»å‹å®šä¹‰æ‰©å±• MarketItem ä»¥åŒ…å« Meme Rush ç‰¹æœ‰çš„å­—æ®µï¼ˆå¦‚è¿›åº¦ã€Devæ•°æ®ç­‰ï¼‰ã€‚ code TypeScriptdownloadcontent_copyexpand_less Â  Â // packages/shared-types/src/index.ts/**Â * æ ¸å¿ƒçš„å¸‚åœºæ•°æ®é¡¹ç»“æ„Â * âœ¨ æ‰©å±•äº† Meme Rush ä¸“å±å­—æ®µÂ */export interface MarketItem {Â  chain: string; Â  contractAddress: string;Â  symbol: string;Â  icon: string;Â  price: number;Â  priceChange24h: string;Â  volume24h: number;Â  marketCap: number;Â  Â  // --- é€šç”¨/å…¶ä»–å­—æ®µ ---Â  source?: string; // æ ‡è¯†æ•°æ®æ¥æºï¼Œä¾‹å¦‚ 'meme-rush'Â  Â  // --- Meme Rush ä¸“å±å­—æ®µ (Optional) ---Â  progress?: number; // ç»‘å®šæ›²çº¿è¿›åº¦ (0-100)Â  holders?: number; // æŒæœ‰äººæ•°Â  devMigrateCount?: number; // å¼€å‘è€…æ›¾å‘å°„è¿‡çš„ä»£å¸æ•°é‡Â  createTime?: number; // åˆ›å»ºæ—¶é—´æˆ³Â  Â  [key: string]: any;}/**Â * WebSocket å’Œæ•°æ®æå–å™¨ä½¿ç”¨çš„é€šç”¨ Payload ç»“æ„Â */export interface DataPayload {Â  type: 'snapshot' | 'update';Â  category?: string; // âœ¨ å¢åŠ  category å­—æ®µå®šä¹‰ï¼Œæ–¹ä¾¿å‰ç«¯åŒºåˆ†Â  data: MarketItem[];}/**Â * æ³¨å…¥æµè§ˆå™¨çš„è„šæœ¬å›ä¼ ç»™ Playwright çš„æ•°æ®ç»“æ„Â */export interface ExtractedDataPayload {Â  type: 'snapshot' | 'update' | 'no-change';Â  data?: any[]; // è¿™é‡Œå¯ä»¥æ˜¯ RawItem æˆ– MarketItemÂ  path: string | null;Â  duration: string;Â  readDuration: string;Â  diffDuration: string;Â  totalCount: number;Â  changedCount: number;Â  cacheHit: boolean;}/**Â * å®šä¹‰äº†ä»ç›®æ ‡ç½‘ç«™æå–å¹¶æ¨é€åˆ°å‰ç«¯çš„å…·ä½“æ•°æ®å­—æ®µÂ * è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿç›‘æ§å­—æ®µçš„â€œå•ä¸€äº‹å®æ¥æºâ€Â */export const DESIRED_FIELDS = [Â  Â  'chain', 'chainId', 'contractAddress', 'symbol', 'icon',Â  Â  'marketCap', 'price',Â  Â  'volume1m', 'volume5m', 'volume1h', 'volume4h', 'volume24h',Â  Â  'priceChange1m', 'priceChange5m', 'priceChange1h', 'priceChange4h', 'priceChange24h',Â  Â  // âœ¨ æ–°å¢ Meme å­—æ®µÂ  Â  'progress', 'holders', 'devMigrateCount', 'createTime', 'source'];Â  2. æ›´æ–° Rust åç«¯ç±»å‹å®šä¹‰Rust éœ€è¦èƒ½å¤Ÿåºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿™äº›æ–°å­—æ®µã€‚ code Rustdownloadcontent_copyexpand_less Â  Â // packages/backend/src/types.rsuse chrono::{DateTime, Utc};use serde::{Deserialize, Serialize};use socketioxide::socket::Sid;use std::collections::HashSet;use std::sync::Arc;use tokio::sync::Mutex;use tokio::task::JoinHandle;// âœ¨ æ·»åŠ  Serialize å¹¶æ‰©å……å­—æ®µ#[derive(Debug, Deserialize, Serialize, Clone)]#[serde(rename_all = "camelCase")]pub struct MarketItem {Â  Â  pub contract_address: Option<String>,Â  Â  pub symbol: Option<String>,Â  Â  pub icon: Option<String>,Â  Â  pub chain: Option<String>,Â  Â  pub price: Option<f64>,Â  Â  pub market_cap: Option<f64>,Â  Â  pub chain_id: Option<String>,Â  Â  pub volume1m: Option<f64>,Â  Â  pub volume5m: Option<f64>,Â  Â  pub volume1h: Option<f64>,Â  Â  pub volume4h: Option<f64>,Â  Â  pub volume24h: Option<f64>,Â  Â  pub price_change1m: Option<f64>,Â  Â  pub price_change5m: Option<f64>,Â  Â  pub price_change1h: Option<f64>,Â  Â  pub price_change4h: Option<f64>,Â  Â  pub price_change24h: Option<f64>,Â  Â  Â  Â  // âœ¨ æ–°å¢: æ ‡è¯†æ¥æºÂ  Â  pub source: Option<String>,Â  Â  // âœ¨ æ–°å¢: Meme Rush ä¸“å±å­—æ®µÂ  Â  pub progress: Option<f64>,Â  Â  pub holders: Option<i64>,Â  Â  pub dev_migrate_count: Option<i64>,Â  Â  pub create_time: Option<i64>,}#[derive(Debug, Deserialize, Clone)]pub struct KlineSubscribePayload {Â  Â  pub address: String,Â  Â  pub chain: String,Â  Â  pub interval: String,}// âœ¨ 1. å®šä¹‰ä¸šåŠ¡åˆ†ç±» (Category) - æ·»åŠ  Serialize#[derive(Debug, Deserialize, Serialize, PartialEq, Eq, Hash, Clone)]pub enum DataCategory {Â  Â  #[serde(rename = "hotlist")]Â  Â  Hotlist,Â  Â  #[serde(rename = "new")]Â  Â  New,Â  Â  #[serde(rename = "meme_new")] // âœ¨ å¯¹åº” Extractor ä¸­çš„ TARGET.categoryÂ  Â  MemeNew,Â  Â  #[serde(other)]Â  Â  Unknown,}// âœ¨ 2. å®šä¹‰åŠ¨ä½œç±»å‹ (Action/Type) - æ·»åŠ  Serialize#[derive(Debug, Deserialize, Serialize, PartialEq, Eq, Clone)]pub enum DataAction {Â  Â  #[serde(rename = "snapshot")]Â  Â  Snapshot,Â  Â  #[serde(rename = "update")]Â  Â  Update,Â  Â  #[serde(other)]Â  Â  Unknown,}// âœ¨ 3. æ›´æ–°åçš„ Payload ç»“æ„ - æ·»åŠ  Serialize#[derive(Debug, Deserialize, Serialize)]pub struct DataPayload {Â  Â  pub category: DataCategory,Â  Â  pub r#type: DataAction,Â  Â  pub data: Vec<MarketItem>,}#[derive(Debug, Deserialize)]pub struct BinanceStreamWrapper<T> {Â  Â  pub stream: String,Â  Â  pub data: T,}#[derive(Debug, Deserialize)]pub struct BinanceKlineDataWrapper {Â  Â  #[serde(rename = "d")]Â  Â  pub kline_data: BinanceKlineDetail,}#[derive(Debug, Deserialize)]#[allow(non_snake_case)]pub struct BinanceKlineDetail {Â  Â  #[serde(rename = "u")]Â  Â  pub values: (String, String, String, String, String, String),}#[derive(Debug, Deserialize)]pub struct BinanceTickDataWrapper {Â  Â  #[serde(rename = "d")]Â  Â  pub tick_data: BinanceTickDetail,}#[derive(Debug, Deserialize)]#[allow(non_snake_case)]pub struct BinanceTickDetail {Â  Â  pub t0a: String,Â  Â  pub t1a: String,Â  Â  pub t0pu: f64,Â  Â  pub t1pu: f64,Â  Â  pub v: f64, // è¿™æ˜¯ USD ä»·å€¼ï¼Œç”¨äºè¿‡æ»¤åƒåœ¾äº¤æ˜“Â  Â  // âœ¨ æ–°å¢å…³é”®å­—æ®µï¼šToken å®é™…æ•°é‡Â  Â  pub a0: f64, Â  Â  pub a1: f64,Â  Â  pub tp: String,}#[derive(Debug, Serialize, Clone)]pub struct KlineBroadcastData {Â  Â  pub room: String,Â  Â  pub data: KlineTick,}#[derive(Debug, Serialize, Clone, Default, PartialEq)]#[serde(rename_all = "camelCase")]pub struct KlineTick {Â  Â  #[serde(with = "chrono::serde::ts_seconds")]Â  Â  pub time: DateTime<Utc>,Â  Â  pub open: f64,Â  Â  pub high: f64,Â  Â  pub low: f64,Â  Â  pub close: f64,Â  Â  pub volume: f64,}#[derive(Debug, Serialize, Clone)]#[serde(rename_all = "camelCase")]pub struct KlineHistoryResponse {Â  Â  pub address: String,Â  Â  pub chain: String,Â  Â  pub interval: String,Â  Â  pub data: Vec<KlineTick>,}pub struct Room {Â  Â  pub clients: HashSet<Sid>,Â  Â  pub task_handle: JoinHandle<()>,Â  Â  pub symbol: String,Â  Â  pub current_kline: Arc<Mutex<Option<KlineTick>>>,}#[derive(Debug, Deserialize)]pub struct ImageProxyQuery {Â  Â  pub url: String,}#[derive(Serialize, Deserialize)]pub struct CacheMeta {Â  Â  pub content_type: String,}#[derive(Debug, Deserialize)]pub struct HistoricalDataWrapper {Â  Â  pub data: Vec<Vec<serde_json::Value>>,}Â  3. æ›´æ–° Rust Socket å¤„ç†é€»è¾‘ç¡®ä¿ MemeNew ç±»å‹çš„æ•°æ®ä¸è¢« MIN_HOTLIST_AMOUNT è¿‡æ»¤å™¨æ‹¦æˆªã€‚ code Rustdownloadcontent_copyexpand_less Â  Â // packages/backend/src/socket_handlers.rsuse super::{Â  Â  binance_task,Â  Â  kline_handler,Â  Â  types::{DataPayload, KlineSubscribePayload, Room, KlineTick, DataCategory},Â  Â  ServerState,};use socketioxide::{Â  Â  extract::{Data, SocketRef},};use std::collections::HashSet;use std::sync::Arc;use tokio::sync::Mutex;use tracing::{error, info, warn};// âœ¨ å®šä¹‰è¿‡æ»¤é˜ˆå€¼ï¼š10ä¸‡ (æˆäº¤é¢ USD)const MIN_HOTLIST_AMOUNT: f64 = 1000.0;pub async fn on_socket_connect(s: SocketRef, state: ServerState) {Â  Â  info!("ğŸ”Œ [Socket.IO] Client connected: {}", s.id);Â  Â  register_data_update_handler(&s, state.clone());Â  Â  register_kline_subscribe_handler(&s, state.clone());Â  Â  register_kline_unsubscribe_handler(&s, state.clone());Â  Â  register_disconnect_handler(&s, state.clone());Â  Â  register_kline_history_handler(&s, state);}fn register_kline_history_handler(socket: &SocketRef, state: ServerState) {Â  Â  socket.on(Â  Â  Â  Â  "request_historical_kline",Â  Â  Â  Â  move |s: SocketRef, payload: Data<KlineSubscribePayload>| {Â  Â  Â  Â  Â  Â  let state = state.clone();Â  Â  Â  Â  Â  Â  async move {Â  Â  Â  Â  Â  Â  Â  Â  kline_handler::handle_kline_request(s, payload, state).await;Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  },Â  Â  );}fn register_data_update_handler(socket: &SocketRef, state: ServerState) {Â  Â  socket.on(Â  Â  Â  Â  "data-update",Â  Â  Â  Â  move |s: SocketRef, payload: Data<serde_json::Value>| {Â  Â  Â  Â  Â  Â  let state = state.clone();Â  Â  Â  Â  Â  Â  async move {Â  Â  Â  Â  Â  Â  Â  Â  // âœ¨ ä¿®æ”¹é€»è¾‘é¡ºåºï¼šå…ˆè§£æ -> å†è¿‡æ»¤ -> æœ€åå¹¿æ’­Â  Â  Â  Â  Â  Â  Â  Â  match serde_json::from_value::<DataPayload>(payload.0) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ok(mut parsed_payload) => {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let original_count = parsed_payload.data.len();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let category = parsed_payload.category.clone();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // âœ¨ æ ¸å¿ƒè¿‡æ»¤é€»è¾‘Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 1. Hotlist: åº”ç”¨ä¸¥æ ¼çš„æˆäº¤é¢è¿‡æ»¤ (æˆäº¤é‡ * ä»·æ ¼)Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if category == DataCategory::Hotlist {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parsed_payload.data.retain(|item| {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let volume = item.volume1h.unwrap_or(0.0);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let price = item.price.unwrap_or(0.0);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let amount = volume * price;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount >= MIN_HOTLIST_AMOUNTÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 2. MemeNew: âœ¨ ä¸è¿›è¡Œé‡‘é¢è¿‡æ»¤ï¼Œå› ä¸ºæ–°å¸é€šå¸¸æ²¡æœ‰å¤šå°‘æˆäº¤é‡Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if category == DataCategory::MemeNew {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // è¿™é‡Œå¯ä»¥æ·»åŠ é’ˆå¯¹ Meme çš„ç‰¹æ®Šè¿‡æ»¤é€»è¾‘Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ä¾‹å¦‚ï¼šåªä¿ç•™æœ‰å›¾æ ‡çš„ï¼Œæˆ–è€… progress > 0 çš„Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ç›®å‰ä¿æŒåŸæ ·è½¬å‘ï¼Œæ–¹ä¾¿å‰ç«¯çœ‹åˆ°æ‰€æœ‰æ–°å¸Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let filtered_count = parsed_payload.data.len();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // âœ¨ æ›´æ–°æ—¥å¿—Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  info!(Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "ğŸ•·ï¸ [SPIDER DATA] Cat: {:?} | Act: {:?} | Filter: {} -> {} {}", Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category, Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parsed_payload.r#type,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  original_count,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  filtered_count,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if category == DataCategory::Hotlist { format!("(1H Amount >= {})", MIN_HOTLIST_AMOUNT) } else { "".to_string() }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // âœ¨ åªæœ‰å½“è¿‡æ»¤åè¿˜æœ‰æ•°æ®æ—¶ï¼Œæ‰å¹¿æ’­ç»™å‰ç«¯Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if !parsed_payload.data.is_empty() {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // è¿™é‡Œç›´æ¥å¹¿æ’­å¤„ç†è¿‡çš„ structï¼Œsocketioxide ä¼šè‡ªåŠ¨åºåˆ—åŒ–å®ƒÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if let Err(e) = s.broadcast().emit("data-broadcast", &parsed_payload).await {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  error!("[Socket.IO] Failed to broadcast filtered data for {}: {:?}", s.id, e);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // æ›´æ–° Symbol Map (ä½¿ç”¨è¿‡æ»¤åçš„é«˜è´¨é‡æ•°æ®)Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  match category {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DataCategory::Unknown => {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  warn!("[SPIDER DATA] Received unknown category, ignoring symbol map update.");Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  _ => {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for item in parsed_payload.data {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if let (Some(address), Some(symbol)) = (item.contract_address, item.symbol) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.token_symbols.insert(address.to_lowercase(), symbol);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Err(e) => {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  warn!("[DATA ERROR] Failed to parse data-update payload: {}", e);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  },Â  Â  );}fn register_kline_subscribe_handler(socket: &SocketRef, state: ServerState) {Â  Â  socket.on(Â  Â  Â  Â  "subscribe_kline",Â  Â  Â  Â  move |s: SocketRef, Data(payload): Data<KlineSubscribePayload>| {Â  Â  Â  Â  Â  Â  let state = state.clone();Â  Â  Â  Â  Â  Â  async move {Â  Â  Â  Â  Â  Â  Â  Â  let chain_lower = payload.chain.to_lowercase();Â  Â  Â  Â  Â  Â  Â  Â  let address_lowercase = payload.address.to_lowercase();Â  Â  Â  Â  Â  Â  Â  Â  let symbol = state.token_symbolsÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  .get(&address_lowercase)Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map_or_else(Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  || format!("{}...", &payload.address[0..6]),Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  |s| s.value().clone()Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );Â  Â  Â  Â  Â  Â  Â  Â  let pool_id = match chain_lower.as_str() {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "bsc" => 14, Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "sol" | "solana" => 16, Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "base" => 199,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unsupported_chain => {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  warn!("âš ï¸ [SUBSCRIBE FAIL] Unsupported chain '{}' (original: '{}') for {}. Ignored.", unsupported_chain, payload.chain, s.id);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  Â  Â  Â  let room_name = format!("kl@{}@{}@{}", pool_id, payload.address, payload.interval);Â  Â  Â  Â  Â  Â  Â  Â  let log_display_name = format!("kl@{}@{}@{}", pool_id, &symbol, payload.interval);Â  Â  Â  Â  Â  Â  Â  Â  info!("ğŸ”” [SUB] Client {} -> Room: {}", s.id, log_display_name);Â  Â  Â  Â  Â  Â  Â  Â  s.join(room_name.clone());Â  Â  Â  Â  Â  Â  Â  Â  state.app_stateÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  .entry(room_name.clone())Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .or_insert_with(|| {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  info!("âœ¨ [ROOM NEW] First subscriber for '{}'. Spawning Binance task...", log_display_name);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let current_kline = Arc::new(Mutex::new(None::<KlineTick>));Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let task_handle = tokio::spawn(binance_task::binance_websocket_task(Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.io.clone(),Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  room_name.clone(),Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  symbol.clone(), Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.config.clone(),Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  current_kline.clone(),Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ));Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Room {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clients: HashSet::new(),Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  task_handle,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  symbol,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  current_kline,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .value_mut()Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .clientsÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  .insert(s.id);Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  },Â  Â  );}fn register_kline_unsubscribe_handler(socket: &SocketRef, state: ServerState) {Â  Â  socket.on(Â  Â  Â  Â  "unsubscribe_kline",Â  Â  Â  Â  move |s: SocketRef, Data(payload): Data<KlineSubscribePayload>| {Â  Â  Â  Â  Â  Â  let state = state.clone();Â  Â  Â  Â  Â  Â  async move {Â  Â  Â  Â  Â  Â  Â  Â  let chain_lower = payload.chain.to_lowercase();Â  Â  Â  Â  Â  Â  Â  Â  let symbol = state.token_symbolsÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  .get(&payload.address.to_lowercase())Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map_or_else(|| format!("{}...", &payload.address[0..6]), |s| s.value().clone());Â  Â  Â  Â  Â  Â  Â  Â  let pool_id = match chain_lower.as_str() {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "bsc" => 14, Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "sol" | "solana" => 16, Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "base" => 199,Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  _ => { return; }Â  Â  Â  Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  Â  Â  Â  let room_name = format!("kl@{}@{}@{}", pool_id, payload.address, payload.interval);Â  Â  Â  Â  Â  Â  Â  Â  let log_display_name = format!("kl@{}@{}@{}", pool_id, &symbol, payload.interval);Â  Â  Â  Â  Â  Â  Â  Â  info!("ğŸ”½ [UNSUB] Client {} leaving room: {}", s.id, log_display_name);Â  Â  Â  Â  Â  Â  Â  Â  s.leave(room_name.clone());Â  Â  Â  Â  Â  Â  Â  Â  if let Some(mut room) = state.app_state.get_mut(&room_name) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  room.clients.remove(&s.id);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if room.clients.is_empty() {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  drop(room);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if let Some((_, room_to_abort)) = state.app_state.remove(&room_name) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  info!("ğŸ—‘ï¸ [ROOM EMPTY] Last client left '{}'. Aborting Binance task.", log_display_name);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  room_to_abort.task_handle.abort();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  },Â  Â  );}fn register_disconnect_handler(socket: &SocketRef, state: ServerState) {Â  Â  socket.on_disconnect(move |s: SocketRef| {Â  Â  Â  Â  let state = state.clone();Â  Â  Â  Â  async move {Â  Â  Â  Â  Â  Â  // info!("ğŸ”Œ [Socket.IO] Client disconnected: {}", s.id);Â  Â  Â  Â  Â  Â  let mut empty_rooms: Vec<(String, String)> = Vec::new();Â  Â  Â  Â  Â  Â  for mut entry in state.app_state.iter_mut() {Â  Â  Â  Â  Â  Â  Â  Â  if entry.value_mut().clients.remove(&s.id) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let log_display_name = {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let parts: Vec<&str> = entry.key().split('@').collect();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if parts.len() == 4 {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  format!("{}@{}@{}@{}", parts[0], parts[1], &entry.value().symbol, parts[3])Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entry.key().to_string()Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if entry.clients.is_empty() {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  empty_rooms.push((entry.key().clone(), log_display_name));Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  for (room_name, log_display_name) in empty_rooms {Â  Â  Â  Â  Â  Â  Â  Â  if let Some((_, room)) = state.app_state.remove(&room_name) {Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  info!("ğŸ—‘ï¸ [ROOM CLEANUP] Room '{}' is now empty. Aborting task.", log_display_name);Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  room.task_handle.abort();Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  }Â  Â  });}Â  4. æ›´æ–° Extractor å®ç°æ•°æ®æ˜ å°„è¿™é‡Œå°†åŸå§‹çš„ MemeRushRawItem æ˜ å°„ä¸ºæ ‡å‡†çš„ MarketItemã€‚ code TypeScriptdownloadcontent_copyexpand_less Â  Â // packages/extractor/src/meme-extractor.tsimport * as fs from 'fs/promises';import * as path from 'path';import { chromium } from 'playwright-extra';import type { Browser, Page } from 'playwright';import stealth from 'puppeteer-extra-plugin-stealth';import { handleGuidePopup, checkAndClickCookieBanner } from './pageInitializer';import * as logger from './logger';import { io, Socket } from 'socket.io-client';import type { ExtractedDataPayload, MarketItem } from 'shared-types';// æ³¨æ„ï¼šç¡®ä¿ MemeRushRawItem åœ¨ shared-types ä¸­å·²å¯¼å‡ºï¼Œå¦‚æœæœªå¯¼å‡ºï¼Œå¯åœ¨æ­¤å¤„å®šä¹‰æ¥å£æˆ–ä½¿ç”¨ anyimport type { MemeRushRawItem } from 'shared-types/src/meme-rush';chromium.use(stealth());// ==============================================================================// --- âš™ï¸ Meme Rush ç”Ÿäº§é…ç½® ---// ==============================================================================const MY_CHROME_PATH = 'F:\\Program Files\\Google\\Chrome\\Application\\chrome.exe';const SERVER_URL = 'http://localhost:3001';const EXTRACTION_INTERVAL_MS = 500;const TARGET = {Â  Â  name: 'BSC_MEME',Â  Â  url: 'https://web3.binance.com/zh-CN/meme-rush?chain=bsc',Â  Â  category: 'meme_new' };// æå–å™¨é…ç½®const MEME_CONFIG = {Â  Â  heuristic: {Â  Â  Â  Â  maxFiberTreeDepth: 100, Â  Â  Â  Â  minArrayLength: 2, Â  Â  Â  Â  requiredKeys: ['symbol', 'contractAddress'], Â  Â  },Â  Â  // è·å–å°½å¯èƒ½å¤šçš„å­—æ®µï¼Œç„¶åæ‰‹åŠ¨æ˜ å°„Â  Â  desiredFields: [Â  Â  Â  Â  'contractAddress', 'symbol', 'name', 'marketCap', 'liquidity', Â  Â  Â  Â  'volume', 'progress', 'holders', 'createTime', 'twitter', Â  Â  Â  Â  'telegram', 'website', 'icon', 'devMigrateCount'Â  Â  ]};// ==============================================================================async function detectStableContainer(page: Page): Promise<string> {Â  Â  const bestSelector = await page.evaluate(() => {Â  Â  Â  Â  const getFiber = (el: any) => Object.keys(el || {}).find(k => k.startsWith('__reactFiber$'));Â  Â  Â  Â  const app = document.querySelector('#__APP');Â  Â  Â  Â  if (app && app.firstElementChild && getFiber(app.firstElementChild)) return '#__APP > div:first-child';Â  Â  Â  Â  if (getFiber(document.querySelector('#__APP'))) return '#__APP';Â  Â  Â  Â  if (getFiber(document.body)) return 'body';Â  Â  Â  Â  return '#__APP'; Â  Â  });Â  Â  return bestSelector;}async function setupMemePage(Â  Â  browser: Browser, Â  Â  browserScriptOriginal: string, Â  Â  socket: Socket): Promise<void> {Â  Â  logger.log(`[Setup] åˆå§‹åŒ– Meme Rush (RAW DUMP MODE)...`, logger.LOG_LEVELS.INFO);Â  Â  const context = await browser.newContext({ viewport: null });Â  Â  const page = await context.newPage();Â  Â  page.on('console', msg => {Â  Â  Â  Â  const text = msg.text();Â  Â  Â  Â  if (text.includes('RAW DATA') || text.includes('{') || text.includes('Smart Async')) {Â  Â  Â  Â  Â  Â  Â console.log(`ğŸ” [BROWSER] ${text}`);Â  Â  Â  Â  }Â  Â  });Â  Â  // âœ¨âœ¨âœ¨ æ ¸å¿ƒï¼šå°† Raw æ•°æ®æ˜ å°„ä¸º System æ ‡å‡†çš„ MarketItem âœ¨âœ¨âœ¨Â  Â  const handleExtractedData = (result: ExtractedDataPayload): void => {Â  Â  Â  Â  const { type, data, changedCount } = result;Â  Â  Â  Â  Â  Â  Â  Â  if (type !== 'no-change') {Â  Â  Â  Â  Â  Â  Â const time = new Date().toLocaleTimeString();Â  Â  Â  Â  Â  Â  Â logger.log(`âš¡ [${TARGET.name}] ${time} | ${type.padEnd(8)} | æ•°é‡: ${String(changedCount).padEnd(3)}`, logger.LOG_LEVELS.INFO);Â  Â  Â  Â  }Â  Â  Â  Â  if (data && data.length > 0 && type !== 'no-change') {Â  Â  Â  Â  Â  Â  // rawData åœ¨è¿™é‡Œå…¶å®æ˜¯ anyï¼Œä½†æˆ‘ä»¬çŸ¥é“å®ƒç¬¦åˆ MemeRushRawItemÂ  Â  Â  Â  Â  Â  // æˆ‘ä»¬éœ€è¦æŠŠå®ƒè½¬æˆ shared-types çš„ MarketItemÂ  Â  Â  Â  Â  Â  const enrichedData: MarketItem[] = (data as unknown as MemeRushRawItem[]).map(raw => ({ Â  Â  Â  Â  Â  Â  Â  Â  // --- åŸºç¡€å­—æ®µæ˜ å°„ ---Â  Â  Â  Â  Â  Â  Â  Â  chain: 'BSC', Â  Â  Â  Â  Â  Â  Â  Â  source: 'meme-rush',Â  Â  Â  Â  Â  Â  Â  Â  contractAddress: raw.contractAddress,Â  Â  Â  Â  Â  Â  Â  Â  symbol: raw.symbol,Â  Â  Â  Â  Â  Â  Â  Â  icon: raw.icon,Â  Â  Â  Â  Â  Â  Â  Â  // Meme Rush åˆ—è¡¨é€šå¸¸æ²¡æœ‰ç›´æ¥çš„ Priceï¼Œæˆ–è€…åœ¨ liquidity é‡Œåæ¨ï¼Œè¿™é‡Œæš‚æ—¶ç½®0æˆ–ç­‰å¾…è¯¦æƒ…æ¥å£Â  Â  Â  Â  Â  Â  Â  Â  price: 0, Â  Â  Â  Â  Â  Â  Â  Â  marketCap: raw.marketCap || 0,Â  Â  Â  Â  Â  Â  Â  Â  volume24h: raw.volume || 0,Â  Â  Â  Â  Â  Â  Â  Â  priceChange24h: "0", // æš‚æ— æ•°æ®Â  Â  Â  Â  Â  Â  Â  Â  // --- æ‰©å±• Meme å­—æ®µ ---Â  Â  Â  Â  Â  Â  Â  Â  progress: raw.progress,Â  Â  Â  Â  Â  Â  Â  Â  holders: raw.holders,Â  Â  Â  Â  Â  Â  Â  Â  devMigrateCount: raw.devMigrateCount,Â  Â  Â  Â  Â  Â  Â  Â  createTime: raw.createTime,Â  Â  Â  Â  Â  Â  Â  Â  // --- è¾…åŠ©æ ‡è®° ---Â  Â  Â  Â  Â  Â  Â  Â  _scrapedAt: Date.now() Â  Â  Â  Â  Â  Â  }));Â  Â  Â  Â  Â  Â  // å‘é€ç»™åç«¯Â  Â  Â  Â  Â  Â  socket.emit('data-update', { Â  Â  Â  Â  Â  Â  Â  Â  category: TARGET.category, Â  Â  Â  Â  Â  Â  Â  Â  type: type, Â  Â  Â  Â  Â  Â  Â  Â  data: enrichedData Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  }Â  Â  };Â  Â  await page.exposeFunction('onDataExtracted', handleExtractedData);Â  Â  await page.addInitScript({ content: `window.originalConsoleLog = console.log;` });Â  Â  try {Â  Â  Â  Â  logger.log(`[Navi] å‰å¾€: ${TARGET.url}`, logger.LOG_LEVELS.INFO);Â  Â  Â  Â  await page.goto(TARGET.url, { waitUntil: 'domcontentloaded', timeout: 60000 });Â  Â  Â  Â  try { await page.waitForSelector('div:has-text("TX")', { timeout: 10000 }); } catch(e) {}Â  Â  Â  Â  await page.waitForTimeout(2000); Â  Â  Â  Â  const dynamicSelector = await detectStableContainer(page);Â  Â  Â  Â  logger.log(`[Target] æŒ‚è½½ç‚¹: ${dynamicSelector}`, logger.LOG_LEVELS.INFO);Â  Â  Â  Â  const options = {Â  Â  Â  Â  Â  Â  selectors: { stableContainer: dynamicSelector },Â  Â  Â  Â  Â  Â  interval: EXTRACTION_INTERVAL_MS,Â  Â  Â  Â  Â  Â  config: MEME_CONFIG.heuristic,Â  Â  Â  Â  Â  Â  desiredFields: MEME_CONFIG.desiredFieldsÂ  Â  Â  Â  };Â  Â  Â  Â  const initScriptContent = `Â  Â  Â  Â  Â  Â  (() => {Â  Â  Â  Â  Â  Â  Â  Â  ${browserScriptOriginal}Â  Â  Â  Â  Â  Â  Â  Â  window.initializeExtractor(${JSON.stringify(options)});Â  Â  Â  Â  Â  Â  })();Â  Â  Â  Â  `;Â  Â  Â  Â  await page.evaluate(initScriptContent);Â  Â  Â  Â  await handleGuidePopup(page);Â  Â  Â  Â  await checkAndClickCookieBanner(page);Â  Â  } catch (error: any) {Â  Â  Â  Â  logger.log(`âŒ [Navi] é”™è¯¯: ${error.message}`, logger.LOG_LEVELS.ERROR);Â  Â  Â  Â  throw error;Â  Â  }Â  Â  logger.log(`âœ… [Setup] è¿è¡Œä¸­. åº”è¯¥èƒ½åœ¨æ—¥å¿—ä¸­çœ‹åˆ° 'RAW DATA DUMP START' äº†ã€‚`, logger.LOG_LEVELS.INFO);}async function main() {Â  Â  logger.init();Â  Â  logger.log('ğŸš€ [MemeExtractor] å¯åŠ¨...', logger.LOG_LEVELS.INFO);Â  Â  const socket: Socket = io(SERVER_URL);Â  Â  let browser: Browser | undefined;Â  Â  try {Â  Â  Â  Â  const browserScriptPath = path.join(__dirname, '..', 'src', 'browser-script.js');Â  Â  Â  Â  const browserScript = await fs.readFile(browserScriptPath, 'utf-8');Â  Â  Â  Â  browser = await chromium.launch({Â  Â  Â  Â  Â  Â  executablePath: MY_CHROME_PATH,Â  Â  Â  Â  Â  Â  headless: false,Â  Â  Â  Â  Â  Â  proxy: { server: 'socks5://127.0.0.1:1080' },Â  Â  Â  Â  Â  Â  args: ['--start-maximized', '--no-sandbox']Â  Â  Â  Â  });Â  Â  Â  Â  await setupMemePage(browser, browserScript, socket);Â  Â  Â  Â  await new Promise(() => {});Â  Â  } catch (e: any) {Â  Â  Â  Â  logger.log(`âŒ é”™è¯¯: ${e.stack}`, logger.LOG_LEVELS.ERROR);Â  Â  } finally {Â  Â  Â  Â  socket.disconnect();Â  Â  Â  Â  if (browser) await browser.close();Â  Â  Â  Â  logger.close();Â  Â  }}main();Â  5. æ›´æ–°å‰ç«¯æ˜¾ç¤º (App.tsx)å‰ç«¯éœ€è¦è¯†åˆ« source === 'meme-rush' å¹¶æ¸²æŸ“ä¸€ä¸ªç‰¹æ®Šçš„è¡¨æ ¼ï¼ŒåŒæ—¶æä¾› Tab åˆ‡æ¢åŠŸèƒ½ã€‚ code Tsxdownloadcontent_copyexpand_less Â  Â // packages/frontend/src/App.tsximport { createSignal, onMount, For, Component, JSX, createMemo, Show } from 'solid-js';import type { MarketItem } from 'shared-types';import { useMarketData } from './hooks/useMarketData';const BACKEND_URL = 'http://localhost:3001';const CHAINS = ['BSC', 'Base', 'Solana'];// --- è¾…åŠ©å‡½æ•°åŒº ---const FIELD_DISPLAY_NAMES: Record<string, string> = {Â  icon: 'å›¾æ ‡',Â  symbol: 'å“ç§',Â  price: 'ä»·æ ¼',Â  marketCap: 'å¸‚å€¼',Â  chain: 'é“¾',Â  contractAddress: 'åˆçº¦åœ°å€',Â  volume1m: 'Vol 1m',Â  volume24h: 'Vol 24h',Â  priceChange24h: 'Chg 24h',Â  // âœ¨ æ–°å¢å­—æ®µæ˜¾ç¤ºåÂ  progress: 'è¿›åº¦',Â  holders: 'æŒæœ‰äºº',Â  devMigrateCount: 'Devå‘å°„æ•°',Â  createTime: 'åˆ›å»ºæ—¶é—´'};const formatPrice = (price: number | null | undefined): string => {Â  if (price === null || price === undefined) return 'N/A';Â  if (price === 0) return '-';Â  if (price < 0.001) return price.toPrecision(4);Â  return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 });};const formatPercentage = (change: string | number | null | undefined): JSX.Element => {Â  if (change === null || change === undefined) return <span class="na">N/A</span>;Â  const value = parseFloat(String(change));Â  const changeClass = value >= 0 ? 'positive' : 'negative';Â  return <span class={changeClass}>{`${value.toFixed(2)}%`}</span>;};const formatVolumeOrMarketCap = (num: number | null | undefined): string => {Â  if (num === null || num === undefined) return 'N/A';Â  if (num > 1_000_000) return `$${(num / 1_000_000).toFixed(2)}M`;Â  if (num > 1_000) return `$${(num / 1_000).toFixed(2)}K`;Â  return `$${num.toLocaleString('en-US', { maximumFractionDigits: 0 })}`;};const formatTime = (ts: number | undefined): string => {Â  Â  if(!ts) return '-';Â  Â  const date = new Date(ts);Â  Â  return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute:'2-digit', second:'2-digit' });};// --- æ’è¡Œæ¦œç»„ä»¶ (å¤ç”¨åŸæœ‰é€»è¾‘) ---interface RankingListProps {Â  data: MarketItem[];Â  rankBy: keyof MarketItem;Â  title: string;Â  count: number;Â  formatter: (value: any) => string | JSX.Element;}const RankingList: Component<RankingListProps> = (props) => {Â  const rankedData = createMemo(() => {Â  Â  const sorted = [...props.data].sort((a, b) => {Â  Â  Â  const valA = a[props.rankBy] ?? -Infinity;Â  Â  Â  const valB = b[props.rankBy] ?? -Infinity;Â  Â  Â  const numA = typeof valA === 'string' ? parseFloat(valA) : valA;Â  Â  Â  const numB = typeof valB === 'string' ? parseFloat(valB) : valB;Â  Â  Â  return numB - numA;Â  Â  });Â  Â  return sorted.slice(0, props.count);Â  });Â  return (Â  Â  <div class="ranking-list">Â  Â  Â  <h3>{props.title}</h3>Â  Â  Â  <ol>Â  Â  Â  Â  <For each={rankedData()} fallback={<li>-</li>}>Â  Â  Â  Â  Â  {(item) => (Â  Â  Â  Â  Â  Â  <li>Â  Â  Â  Â  Â  Â  Â  <span class="symbol" title={item.symbol}>{item.symbol}</span>Â  Â  Â  Â  Â  Â  Â  <span class="value">{props.formatter(item[props.rankBy])}</span>Â  Â  Â  Â  Â  Â  </li>Â  Â  Â  Â  Â  )}Â  Â  Â  Â  </For>Â  Â  Â  </ol>Â  Â  </div>Â  );};// --- MarketRow ç»„ä»¶ (å¸¸è§„è¡¨æ ¼) ---interface MarketRowProps {Â  item: MarketItem;}const MarketRow: Component<MarketRowProps> = (props) => {Â  const { item } = props;Â  const proxiedIconUrl = () => `${BACKEND_URL}/image-proxy?url=${encodeURIComponent(item.icon!)}`;Â  const handleRowClick = () => {Â  Â  Â  window.open(`/token.html?address=${item.contractAddress}&chain=${item.chain}`, '_blank');Â  };Â  return (Â  Â  <tr onClick={handleRowClick} style={{ cursor: 'pointer' }}>Â  Â  Â  <td><img src={proxiedIconUrl()} alt={item.symbol} class="icon" /></td>Â  Â  Â  <td>{item.symbol}</td>Â  Â  Â  <td>{item.chain}</td>Â  Â  Â  <td>{formatPrice(item.price)}</td>Â  Â  Â  <td>{formatPercentage(item.priceChange24h)}</td>Â  Â  Â  <td>{formatVolumeOrMarketCap(item.volume24h)}</td>Â  Â  Â  <td>{formatVolumeOrMarketCap(item.marketCap)}</td>Â  Â  Â  <td title={item.contractAddress}>{`${String(item.contractAddress).substring(0, 6)}...`}</td>Â  Â  Â  <td>{formatVolumeOrMarketCap(item.volume1m)}</td>Â  Â  </tr>Â  );};// âœ¨ MemeRow ç»„ä»¶ (ä¸“å±è¡¨æ ¼è¡Œ)const MemeRow: Component<MarketRowProps> = (props) => {Â  Â  const { item } = props;Â  Â  const proxiedIconUrl = () => item.icon ? `${BACKEND_URL}/image-proxy?url=${encodeURIComponent(item.icon)}` : '';Â  Â  const handleRowClick = () => {Â  Â  Â  Â  window.open(`/token.html?address=${item.contractAddress}&chain=${item.chain}`, '_blank');Â  Â  };Â  Â  // è¿›åº¦æ¡é¢œè‰²é€»è¾‘Â  Â  const progressColor = () => (item.progress || 0) >= 90 ? '#28a745' : ((item.progress || 0) >= 50 ? '#ffc107' : '#007bff');Â  Â  return (Â  Â  Â  <tr onClick={handleRowClick} style={{ cursor: 'pointer', "font-size": "0.9em" }}>Â  Â  Â  Â  <td>Â  Â  Â  Â  Â  Â  <Show when={item.icon} fallback={<div class="icon" style="background:#eee">?</div>}>Â  Â  Â  Â  Â  Â  Â  Â  <img src={proxiedIconUrl()} alt={item.symbol} class="icon" />Â  Â  Â  Â  Â  Â  </Show>Â  Â  Â  Â  </td>Â  Â  Â  Â  <td style={{ "font-weight": "bold" }}>{item.symbol}</td>Â  Â  Â  Â  <td>{formatTime(item.createTime)}</td>Â  Â  Â  Â  <td>Â  Â  Â  Â  Â  Â  <div style={{ display: 'flex', 'align-items': 'center', gap: '5px' }}>Â  Â  Â  Â  Â  Â  Â  Â  <div style={{ width: '50px', height: '6px', background: '#e9ecef', 'border-radius': '3px' }}>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style={{ width: `${item.progress || 0}%`, height: '100%', background: progressColor(), 'border-radius': '3px' }}></div>Â  Â  Â  Â  Â  Â  Â  Â  </div>Â  Â  Â  Â  Â  Â  Â  Â  <span>{item.progress?.toFixed(2)}%</span>Â  Â  Â  Â  Â  Â  </div>Â  Â  Â  Â  </td>Â  Â  Â  Â  <td>{formatVolumeOrMarketCap(item.marketCap)}</td>Â  Â  Â  Â  <td>{item.holders}</td>Â  Â  Â  Â  <td>{item.devMigrateCount ?? '-'}</td>Â  Â  Â  Â  <td title={item.contractAddress} style={{ color: '#999' }}>{`${String(item.contractAddress).substring(0, 4)}...`}</td>Â  Â  Â  </tr>Â  Â  );Â  };// --- App ---const App: Component = () => {Â  const { marketData, connectionStatus, lastUpdate } = useMarketData();Â  const [activeTab, setActiveTab] = createSignal<'hot' | 'meme'>('meme'); // é»˜è®¤æ˜¾ç¤º MemeÂ  const [selectedChain, setSelectedChain] = createSignal<string>(CHAINS[0]);Â  Â  // 1. å¸¸è§„æ•°æ®è¿‡æ»¤Â  const hotData = createMemo(() => Â  Â  marketData.filter(item => item.source !== 'meme-rush' && item.chain === selectedChain())Â  );Â  // 2. Meme Rush æ•°æ®è¿‡æ»¤ (ä¸è¿‡æ»¤é“¾ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è¿‡æ»¤)Â  const memeData = createMemo(() => Â  Â  marketData.filter(item => item.source === 'meme-rush').sort((a,b) => (b.createTime || 0) - (a.createTime || 0))Â  );Â  return (Â  Â  <>Â  Â  Â  <div style={{ display: 'flex', 'justify-content': 'space-between', 'align-items': 'center' }}>Â  Â  Â  Â  <h1>ğŸš€ å¸‚åœºç›‘æ§é¢æ¿</h1>Â  Â  Â  Â  <div class="stats" style={{ padding: '5px 15px', 'flex-basis': 'auto' }}>Â  Â  Â  Â  Â  Â  <span class={connectionStatus().includes('Connected') ? 'connected' : 'disconnected'}>Â  Â  Â  Â  Â  Â  Â  Â {connectionStatus()}Â  Â  Â  Â  Â  Â  </span>Â  Â  Â  Â  Â  Â  <span style={{ "margin-left": "10px", "font-size": "0.8em", color: "#666" }}>Updated: {lastUpdate()}</span>Â  Â  Â  Â  </div>Â  Â  Â  </div>Â  Â  Â  {/* --- Tab åˆ‡æ¢ --- */}Â  Â  Â  <div class="chain-selector" style={{ 'justify-content': 'flex-start', 'margin-bottom': '10px' }}>Â  Â  Â  Â  <button class={activeTab() === 'meme' ? 'active' : ''} onClick={() => setActiveTab('meme')}>Meme Rush (æ–°å¸)</button>Â  Â  Â  Â  <button class={activeTab() === 'hot' ? 'active' : ''} onClick={() => setActiveTab('hot')}>å¸¸è§„çƒ­é—¨</button>Â  Â  Â  </div>Â  Â  Â  <Show when={activeTab() === 'hot'}>Â  Â  Â  Â  Â  {/* --- é“¾é€‰æ‹©å™¨ (ä»…ç”¨äºå¸¸è§„) --- */}Â  Â  Â  Â  Â  <div class="chain-selector">Â  Â  Â  Â  Â  Â  <For each={CHAINS}>Â  Â  Â  Â  Â  Â  Â  {(chain) => (Â  Â  Â  Â  Â  Â  Â  Â  <buttonÂ  Â  Â  Â  Â  Â  Â  Â  Â  class={selectedChain() === chain ? 'active' : ''}Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick={() => setSelectedChain(chain)}Â  Â  Â  Â  Â  Â  Â  Â  >Â  Â  Â  Â  Â  Â  Â  Â  Â  {chain}Â  Â  Â  Â  Â  Â  Â  Â  </button>Â  Â  Â  Â  Â  Â  Â  )}Â  Â  Â  Â  Â  Â  </For>Â  Â  Â  Â  Â  </div>Â  Â  Â  Â  Â  <div class="table-container">Â  Â  Â  Â  Â  Â  <table>Â  Â  Â  Â  Â  Â  Â  <thead>Â  Â  Â  Â  Â  Â  Â  Â  <tr>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>å›¾æ ‡</th><th>å“ç§</th><th>é“¾</th><th>ä»·æ ¼</th><th>24hæ¶¨å¹…</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>24hé‡</th><th>å¸‚å€¼</th><th>åˆçº¦</th><th>1mé‡</th>Â  Â  Â  Â  Â  Â  Â  Â  </tr>Â  Â  Â  Â  Â  Â  Â  </thead>Â  Â  Â  Â  Â  Â  Â  <tbody>Â  Â  Â  Â  Â  Â  Â  Â  <For each={hotData()} fallback={<tr><td colspan={9} style="text-align:center; padding: 20px;">æš‚æ— æ•°æ®</td></tr>}>Â  Â  Â  Â  Â  Â  Â  Â  Â  {(item) => <MarketRow item={item} />}Â  Â  Â  Â  Â  Â  Â  Â  </For>Â  Â  Â  Â  Â  Â  Â  </tbody>Â  Â  Â  Â  Â  Â  </table>Â  Â  Â  Â  Â  </div>Â  Â  Â  </Show>Â  Â  Â  <Show when={activeTab() === 'meme'}>Â  Â  Â  Â  Â  <div class="table-container">Â  Â  Â  Â  Â  Â  <h3 style={{ padding: '10px' }}>BSC Meme Rush (å®æ—¶æ–°å¸) - å…± {memeData().length} ä¸ª</h3>Â  Â  Â  Â  Â  Â  <table>Â  Â  Â  Â  Â  Â  Â  <thead>Â  Â  Â  Â  Â  Â  Â  Â  <tr>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th width="50">å›¾æ ‡</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Symbol</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>åˆ›å»ºæ—¶é—´</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>è¿›åº¦ (Bonding Curve)</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>å¸‚å€¼</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>æŒæœ‰äºº</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Devå‘å°„æ•°</th>Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>åˆçº¦</th>Â  Â  Â  Â  Â  Â  Â  Â  </tr>Â  Â  Â  Â  Â  Â  Â  </thead>Â  Â  Â  Â  Â  Â  Â  <tbody>Â  Â  Â  Â  Â  Â  Â  Â  <For each={memeData()} fallback={<tr><td colspan={8} style="text-align:center; padding: 20px;">ç­‰å¾…æ–°å¸æ¨é€...</td></tr>}>Â  Â  Â  Â  Â  Â  Â  Â  Â  {(item) => <MemeRow item={item} />}Â  Â  Â  Â  Â  Â  Â  Â  </For>Â  Â  Â  Â  Â  Â  Â  </tbody>Â  Â  Â  Â  Â  Â  </table>Â  Â  Â  Â  Â  </div>Â  Â  Â  </Show>Â  Â  </>Â  );};export default App;Â  